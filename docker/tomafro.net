map $http_width $width {
  '' "-";
}

server {
  listen 80;

  server_name tomafro.net tomafro.net.local localhost;
  root /var/www/tomafro.net;

  error_page 404 /404.html;

  location ~* /images/* {
    add_header Pragma public;
    add_header Cache-Control "public";

    if ($http_width) {
      image_filter resize 10 -;
      add_header Vary Width;
      add_header Content-Width $http_width
      image_filter resize $http_width -;
    }

    expires 90d;
    try_files  $uri =404;
  }

  location / {
    expires 10m;
    add_header Pragma public;
    add_header Cache-Control "public";

    try_files $uri $uri/index.html $uri.html =404;
  }
}
